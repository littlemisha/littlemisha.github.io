<!-- 引入 Prism.js 核心 -->
<link rel="stylesheet" 
      href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>

<!-- 引入复制插件 -->
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>

<!-- 引入笔记专用样式 -->
<link rel="stylesheet" href="{{ '/note/assets/css/notes.css' | relative_url }}?v=1">

<!-- 修复脚本 -->
<script>
// 确保在页面完全加载后执行
window.addEventListener('load', function() {
  // 1. 重新初始化 Prism（确保处理动态内容）
  Prism.highlightAll();
  
  // 2. 添加复制成功反馈
  document.querySelectorAll('.copy-to-clipboard-button').forEach(btn => {
    btn.addEventListener('click', function() {
      const originalText = this.textContent;
      this.textContent = '✓ 已复制';
      
      setTimeout(() => {
        this.textContent = originalText;
      }, 2000);
    });
  });
  
  // 3. 确保复制按钮可见
  document.querySelectorAll('.copy-to-clipboard-button').forEach(btn => {
    btn.style.display = 'block';
    btn.style.opacity = '1';
  });
  
  // 4. 添加语言标签
  document.querySelectorAll('pre[class*="language-"]').forEach(pre => {
    const langClass = [...pre.classList].find(c => c.startsWith('language-'));
    if (langClass) {
      const lang = langClass.replace('language-', '');
      const label = document.createElement('div');
      label.className = 'code-language';
      label.textContent = lang;
      pre.prepend(label);
    }
  });
  
  console.log('Prism.js 复制插件已激活');
});
</script>